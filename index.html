<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pendulum Wave Synchronization</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet" />
<style>
    :root {
        color-scheme: light;
        --bg: #f4f6fb;
        --bg-alt: #ffffff;
        --surface: #ffffff;
        --surface-strong: #ecf0ff;
        --text: #0f172a;
        --text-muted: #52607a;
        --primary: #4f46e5;
        --accent: #06b6d4;
        --border: #dbe1ee;
        --shadow: 0 24px 60px rgba(15, 23, 42, 0.12);
    }

    :root.dark {
        color-scheme: dark;
        --bg: #0b0f1b;
        --bg-alt: #111827;
        --surface: #111827;
        --surface-strong: #1f2937;
        --text: #f8fafc;
        --text-muted: #94a3b8;
        --primary: #818cf8;
        --accent: #22d3ee;
        --border: #243145;
        --shadow: 0 32px 80px rgba(0, 0, 0, 0.45);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        min-height: 100vh;
        background: radial-gradient(circle at top, rgba(99, 102, 241, 0.16), transparent 55%),
            radial-gradient(circle at 20% 20%, rgba(34, 211, 238, 0.2), transparent 40%),
            var(--bg);
        font-family: "Space Grotesk", system-ui, sans-serif;
        color: var(--text);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 32px 20px;
    }

    .app {
        width: min(1080px, 100%);
        display: grid;
        gap: 24px;
        grid-template-columns: minmax(0, 2fr) minmax(280px, 1fr);
        align-items: stretch;
    }

    header {
        grid-column: 1 / -1;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
    }

    .title {
        display: grid;
        gap: 6px;
    }

    .title h1 {
        font-size: clamp(1.8rem, 2vw + 1.4rem, 2.8rem);
        letter-spacing: -0.03em;
    }

    .title p {
        color: var(--text-muted);
        max-width: 540px;
    }

    .pill {
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 0.75rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-weight: 600;
        background: var(--surface-strong);
        color: var(--primary);
        border: 1px solid transparent;
    }

    .panel {
        background: var(--surface);
        border-radius: 24px;
        border: 1px solid var(--border);
        box-shadow: var(--shadow);
        padding: 20px;
    }

    .canvas-panel {
        display: grid;
        gap: 16px;
    }

    .canvas-wrap {
        background: linear-gradient(140deg, rgba(79, 70, 229, 0.12), rgba(34, 211, 238, 0.05)),
            var(--bg-alt);
        border-radius: 20px;
        border: 1px solid var(--border);
        padding: 16px;
        min-height: 420px;
        display: grid;
    }

    canvas {
        width: 100%;
        height: 100%;
    }

    .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
    }

    .stat {
        background: var(--surface-strong);
        border-radius: 16px;
        padding: 12px 14px;
        display: grid;
        gap: 4px;
        border: 1px solid transparent;
    }

    .stat span {
        font-size: 0.75rem;
        color: var(--text-muted);
        letter-spacing: 0.08em;
        text-transform: uppercase;
    }

    .stat strong {
        font-size: 1.1rem;
    }

    .controls {
        display: grid;
        gap: 16px;
    }

    .control-group {
        display: grid;
        gap: 8px;
    }

    label {
        font-size: 0.85rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
    }

    input[type="range"] {
        width: 100%;
        accent-color: var(--primary);
    }

    .buttons {
        display: grid;
        gap: 10px;
    }

    button {
        border: none;
        font: inherit;
        border-radius: 14px;
        padding: 12px 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        background: var(--primary);
        color: white;
        box-shadow: 0 12px 25px rgba(79, 70, 229, 0.3);
    }

    button.secondary {
        background: var(--surface-strong);
        color: var(--text);
        box-shadow: none;
        border: 1px solid var(--border);
    }

    button:active {
        transform: translateY(1px) scale(0.99);
    }

    .toggle {
        display: inline-flex;
        gap: 8px;
        align-items: center;
        padding: 8px 12px;
        border-radius: 999px;
        background: var(--surface);
        border: 1px solid var(--border);
        font-size: 0.85rem;
        cursor: pointer;
    }

    .toggle span {
        font-weight: 600;
    }

    .note {
        font-size: 0.8rem;
        color: var(--text-muted);
        line-height: 1.4;
    }

    @media (max-width: 900px) {
        .app {
            grid-template-columns: 1fr;
        }

        header {
            flex-direction: column;
            align-items: flex-start;
        }
    }
</style>
</head>
<body>
<div class="app">
    <header>
        <div class="title">
            <span class="pill">Pendulum Wave Lab</span>
            <h1>Pendulum Wave Synchronization</h1>
            <p>Each bob swings at its own period, but every few seconds they return to perfect alignment. Adjust the tempo and feel the resonance.</p>
        </div>
        <button id="theme-toggle" class="toggle" aria-label="Toggle dark mode">
            <span id="theme-icon">☾</span>
            <span id="theme-label">Dark mode</span>
        </button>
    </header>

    <section class="panel canvas-panel">
        <div class="canvas-wrap">
            <canvas id="pendulum-canvas" aria-label="Pendulum wave animation"></canvas>
        </div>
        <div class="stats">
            <div class="stat">
                <span>Sync interval</span>
                <strong id="sync-interval">--</strong>
            </div>
            <div class="stat">
                <span>Active period</span>
                <strong id="period-display">--</strong>
            </div>
            <div class="stat">
                <span>Amplitude</span>
                <strong id="amplitude-display">--</strong>
            </div>
            <div class="stat">
                <span>Oscillators</span>
                <strong id="count-display">--</strong>
            </div>
        </div>
    </section>

    <aside class="panel controls">
        <div class="control-group">
            <label for="count">Pendulum count <span id="count-value">15</span></label>
            <input id="count" type="range" min="8" max="24" value="15" />
        </div>
        <div class="control-group">
            <label for="amplitude">Swing amplitude <span id="amplitude-value">18°</span></label>
            <input id="amplitude" type="range" min="8" max="30" value="18" />
        </div>
        <div class="control-group">
            <label for="interval">Sync interval <span id="interval-value">20.0s</span></label>
            <input id="interval" type="range" min="8" max="30" value="20" step="0.5" />
        </div>
        <div class="control-group">
            <label for="tempo">Tempo multiplier <span id="tempo-value">1.0×</span></label>
            <input id="tempo" type="range" min="0.5" max="2" value="1" step="0.05" />
        </div>
        <div class="buttons">
            <button id="play-btn">Pause</button>
            <button id="reset-btn" class="secondary">Reset to sync</button>
        </div>
        <p class="note">Tip: Shorter sync intervals make the wave pulse faster, while more pendulums reveal denser interference patterns.</p>
    </aside>
</div>

<script>
    const canvas = document.getElementById('pendulum-canvas');
    const ctx = canvas.getContext('2d');
    const syncIntervalEl = document.getElementById('sync-interval');
    const periodDisplay = document.getElementById('period-display');
    const amplitudeDisplay = document.getElementById('amplitude-display');
    const countDisplay = document.getElementById('count-display');

    const countInput = document.getElementById('count');
    const amplitudeInput = document.getElementById('amplitude');
    const intervalInput = document.getElementById('interval');
    const tempoInput = document.getElementById('tempo');

    const countValue = document.getElementById('count-value');
    const amplitudeValue = document.getElementById('amplitude-value');
    const intervalValue = document.getElementById('interval-value');
    const tempoValue = document.getElementById('tempo-value');

    const playBtn = document.getElementById('play-btn');
    const resetBtn = document.getElementById('reset-btn');

    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    const themeLabel = document.getElementById('theme-label');

    const g = 9.81;
    let pendulums = [];
    let startTime = performance.now();
    let paused = false;
    let pauseStart = 0;
    let accumulatedPause = 0;

    function setTheme(mode) {
        document.documentElement.classList.toggle('dark', mode === 'dark');
        themeIcon.textContent = mode === 'dark' ? '☀' : '☾';
        themeLabel.textContent = mode === 'dark' ? 'Light mode' : 'Dark mode';
        localStorage.setItem('theme', mode);
    }

    const storedTheme = localStorage.getItem('theme');
    if (storedTheme) {
        setTheme(storedTheme);
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        setTheme('dark');
    }

    themeToggle.addEventListener('click', () => {
        const isDark = document.documentElement.classList.contains('dark');
        setTheme(isDark ? 'light' : 'dark');
    });

    function resizeCanvas() {
        const rect = canvas.parentElement.getBoundingClientRect();
        const scale = window.devicePixelRatio || 1;
        canvas.width = rect.width * scale;
        canvas.height = rect.height * scale;
        ctx.setTransform(scale, 0, 0, scale, 0, 0);
    }

    function buildPendulums() {
        const count = Number(countInput.value);
        const interval = Number(intervalInput.value);
        const minPeriod = interval / (count + 1);
        pendulums = Array.from({ length: count }, (_, index) => {
            const period = interval / (count - index);
            const length = g * Math.pow(period / (2 * Math.PI), 2);
            return {
                index,
                period,
                length
            };
        });
        syncIntervalEl.textContent = `${interval.toFixed(1)}s`;
        periodDisplay.textContent = `${minPeriod.toFixed(2)}s → ${interval.toFixed(2)}s`;
        amplitudeDisplay.textContent = `${amplitudeInput.value}°`;
        countDisplay.textContent = String(count);
        countValue.textContent = String(count);
    }

    function draw(now) {
        if (!paused) {
            const t = (now - startTime - accumulatedPause) / 1000;
            const tempo = Number(tempoInput.value);
            renderScene(t * tempo);
        } else {
            const t = (pauseStart - startTime - accumulatedPause) / 1000;
            renderScene(t * Number(tempoInput.value));
        }
        requestAnimationFrame(draw);
    }

    function renderScene(t) {
        const { width, height } = canvas.getBoundingClientRect();
        ctx.clearRect(0, 0, width, height);

        const margin = 48;
        const top = 30;
        const spacing = (width - margin * 2) / (pendulums.length - 1 || 1);
        const maxLength = height - 120;
        const maxPhysicsLength = Math.max(...pendulums.map(p => p.length));

        pendulums.forEach((pendulum, idx) => {
            const x = margin + spacing * idx;
            const lengthScale = maxLength / maxPhysicsLength;
            const length = pendulum.length * lengthScale;
            const amplitude = (Number(amplitudeInput.value) * Math.PI) / 180;
            const angle = amplitude * Math.cos((2 * Math.PI * t) / pendulum.period);

            const bobX = x + Math.sin(angle) * length;
            const bobY = top + Math.cos(angle) * length;

            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--border');
            ctx.lineWidth = 1.4;
            ctx.beginPath();
            ctx.moveTo(x, top);
            ctx.lineTo(bobX, bobY);
            ctx.stroke();

            const gradient = ctx.createRadialGradient(bobX, bobY, 2, bobX, bobY, 12);
            gradient.addColorStop(0, getComputedStyle(document.documentElement).getPropertyValue('--accent'));
            gradient.addColorStop(1, getComputedStyle(document.documentElement).getPropertyValue('--primary'));

            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(bobX, bobY, 8.5, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-muted');
            ctx.font = '600 10px "JetBrains Mono", monospace';
            ctx.textAlign = 'center';
            ctx.fillText(`${pendulum.period.toFixed(2)}s`, x, height - 18);
        });
    }

    function resetSync() {
        startTime = performance.now();
        accumulatedPause = 0;
        if (paused) {
            pauseStart = startTime;
        }
    }

    function updateControls() {
        amplitudeValue.textContent = `${amplitudeInput.value}°`;
        intervalValue.textContent = `${Number(intervalInput.value).toFixed(1)}s`;
        tempoValue.textContent = `${Number(tempoInput.value).toFixed(2)}×`;
        buildPendulums();
    }

    countInput.addEventListener('input', () => {
        updateControls();
        resetSync();
    });
    amplitudeInput.addEventListener('input', () => {
        amplitudeValue.textContent = `${amplitudeInput.value}°`;
        amplitudeDisplay.textContent = `${amplitudeInput.value}°`;
    });
    intervalInput.addEventListener('input', () => {
        intervalValue.textContent = `${Number(intervalInput.value).toFixed(1)}s`;
        updateControls();
        resetSync();
    });
    tempoInput.addEventListener('input', () => {
        tempoValue.textContent = `${Number(tempoInput.value).toFixed(2)}×`;
    });

    playBtn.addEventListener('click', () => {
        paused = !paused;
        if (paused) {
            pauseStart = performance.now();
            playBtn.textContent = 'Play';
        } else {
            accumulatedPause += performance.now() - pauseStart;
            playBtn.textContent = 'Pause';
        }
    });

    resetBtn.addEventListener('click', resetSync);

    window.addEventListener('resize', () => {
        resizeCanvas();
        renderScene(0);
    });

    resizeCanvas();
    updateControls();
    requestAnimationFrame(draw);
</script>
</body>
</html>
